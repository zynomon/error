<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Directory Index</title>

        <style>
            body {
                font-family: monospace;
                margin: 0;
                padding: 0;
                background: #000;
                color: #e0e0e0;
                display: flex;
                justify-content: center;
                align-items: center;
                min-height: 100vh;
            }
            body.light {
                background: #f5f5f5;
                color: #111;
            }

            #viewer-box {
                position: relative;
                width: 90%;
                max-width: 900px;
                border-radius: 14px;
                overflow: hidden;
                box-shadow:
                    0 18px 40px rgba(0, 0, 0, 0.7),
                    0 0 60px rgba(136, 136, 136, 0.45);
            }
            body.light #viewer-box {
                box-shadow:
                    0 18px 40px rgba(0, 0, 0, 0.25),
                    0 0 40px rgba(50, 50, 50, 0.25);
            }

            #noise-layer {
                position: absolute;
                inset: 0;
                z-index: 0;
            }
            #noise-layer svg {
                width: 100%;
                height: 100%;
                display: block;
            }

            #content-layer {
                position: relative;
                z-index: 1;
                padding: 20px;
                background: linear-gradient(
                    145deg,
                    rgba(10, 10, 10, 0.96),
                    rgba(18, 18, 18, 0.98)
                );
                backdrop-filter: blur(10px);
            }
            body.light #content-layer {
                background: linear-gradient(
                    145deg,
                    rgba(245, 245, 245, 0.96),
                    rgba(255, 255, 255, 0.98)
                );
            }

            #darkToggle {
                padding: 6px 12px;
                border-radius: 4px;
                border: 1px solid #ccc;
                cursor: pointer;
                background: #222;
                color: #eee;
                margin-bottom: 12px;
            }
            body.light #darkToggle {
                background: #e0e0e0;
                color: #111;
                border-color: #888;
            }

            #breadcrumbs {
                margin-bottom: 12px;
                font-size: 14px;
            }
            #breadcrumbs .crumb {
                cursor: pointer;
                color: #9ed0ff;
                display: inline-flex;
                align-items: center;
            }
            body.light #breadcrumbs .crumb {
                color: #0050aa;
            }
            #breadcrumbs img {
                width: 14px;
                height: 14px;
                margin-right: 4px;
                opacity: 0.85;
            }
            body.light #breadcrumbs img {
                opacity: 0.75;
            }

            #listing {
                list-style: none;
                padding: 0;
                margin: 0;
                border-radius: 8px;
                background: rgba(5, 5, 5, 0.7);
                border: 1px solid rgba(90, 90, 90, 0.4);
            }
            body.light #listing {
                background: rgba(255, 255, 255, 0.8);
                border-color: rgba(150, 150, 150, 0.4);
            }

            #listing li {
                display: flex;
                align-items: center;
                gap: 8px;
                padding: 6px 10px;
                border-bottom: 1px solid rgba(70, 70, 70, 0.35);
                font-size: 13px;
            }
            body.light #listing li {
                border-bottom-color: rgba(180, 180, 180, 0.5);
            }

            #listing li img {
                width: 16px;
                height: 16px;
            }

            #listing li a {
                color: inherit;
                text-decoration: none;
            }
            #listing li a:hover {
                text-decoration: underline;
            }

            .meta {
                margin-left: auto;
                opacity: 0.7;
                font-size: 12px;
            }
        </style>
    </head>

    <body>
        <div id="viewer-box">
            <div id="noise-layer">
                <svg
                    viewBox="0 0 200 200"
                    xmlns="http://www.w3.org/2000/svg"
                    preserveAspectRatio="none"
                >
                    <filter id="noiseFilter">
                        <feTurbulence
                            type="fractalNoise"
                            baseFrequency="0.9"
                            numOctaves="4"
                            stitchTiles="stitch"
                        />
                    </filter>
                    <rect
                        width="100%"
                        height="100%"
                        filter="url(#noiseFilter)"
                        opacity="0.17"
                    />
                </svg>
            </div>

            <div id="content-layer">
                <button id="darkToggle">light</button>
                <div id="breadcrumbs"></div>
                <ul id="listing"></ul>
            </div>
        </div>

        <script>
            const ICONS =
                "https://raw.githubusercontent.com/zynomon/error/web-side/icons/";
            const repoOwner = "zynomon";
            const repoName = "error";
            const branch = "web-side";

            document.getElementById("darkToggle").onclick = function () {
                document.body.classList.toggle("light");
                this.textContent = document.body.classList.contains("light")
                    ? "dark"
                    : "light";
            };

            let path = window.location.pathname;
            path = path.replace(/^\/error\//, "");
            path = path.replace(/e\.html$/, "");
            if (path.endsWith("/")) path = path.slice(0, -1);

            function breadcrumbs(path) {
                const bc = document.getElementById("breadcrumbs");
                bc.innerHTML = "";
                const parts = path === "" ? ["root"] : path.split("/");
                let cur = "";
                parts.forEach((p, i) => {
                    if (p !== "root") cur += (i ? "/" : "") + p;

                    const span = document.createElement("span");
                    span.className = "crumb";

                    const img = document.createElement("img");
                    img.src = ICONS + "dir.png";

                    span.appendChild(img);
                    span.appendChild(document.createTextNode(p));

                    span.onclick = () => {
                        if (p === "root") {
                            window.location.href = "/error/e.html";
                        } else {
                            const up = "../".repeat(parts.length - i - 1);
                            window.location.href = up + "e.html";
                        }
                    };

                    bc.appendChild(span);
                    if (i < parts.length - 1)
                        bc.appendChild(document.createTextNode(" / "));
                });
            }

            function iconFor(name, type, path) {
                if (name === "..") return "dirback.png";
                if (type === "dir") return "dir.png";
                if (name.endsWith(".deb")) return "deb.png";
                if (name.includes("Packages")) return "pac.png";
                if (
                    [
                        "Release",
                        "InRelease",
                        "Release.gpg",
                        "error.gpg",
                    ].includes(name)
                )
                    return "key.png";
                if (path.includes("/i18n/") || name.includes("Translation"))
                    return "lang.png";
                return "other.png";
            }

            async function loadDir(path) {
                breadcrumbs(path);
                const ul = document.getElementById("listing");
                ul.innerHTML = "";
                const api = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${path}?ref=${branch}`;
                let data;
                try {
                    const res = await fetch(api);
                    data = await res.json();
                    if (!Array.isArray(data)) throw 0;
                } catch {
                    ul.innerHTML = "<li>error loading directory</li>";
                    return;
                }
                if (path !== "") {
                    const li = document.createElement("li");
                    const img = document.createElement("img");
                    img.src = ICONS + "dirback.png";
                    li.appendChild(img);
                    const a = document.createElement("a");
                    a.textContent = "..";
                    a.href = "../e.html";
                    li.appendChild(a);
                    ul.appendChild(li);
                }
                data.sort((a, b) => {
                    if (a.type === b.type) return a.name.localeCompare(b.name);
                    return a.type === "dir" ? -1 : 1;
                });
                for (const item of data) {
                    const li = document.createElement("li");
                    const img = document.createElement("img");
                    img.src = ICONS + iconFor(item.name, item.type, path);
                    li.appendChild(img);
                    const a = document.createElement("a");
                    a.textContent = item.name;
                    if (item.type === "dir") {
                        a.href = item.name + "/e.html";
                    } else {
                        a.href = item.download_url;
                    }
                    li.appendChild(a);
                    ul.appendChild(li);
                }
            }

            loadDir(path);
        </script>
    </body>
</html>
